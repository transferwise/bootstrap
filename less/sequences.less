@sequence-item-spacing: 4px;
@sequence-item-spacing-lg: 12px;
@sequence-margin-lg: 24px;
@sequence-outside-spacing: (@sequence-margin + @sequence-item-spacing);
@sequence-outside-spacing-lg: (@sequence-margin-lg + @sequence-item-spacing-lg);
@sequence-spacing-horizontal-lg: 48px;
@sequence-icon-size-md: 32px;
@sequence-icon-size-lg: 40px;


.sequence-vertical-spacing(
  @sequence-outside-spacing,
  @sequence-margin,
  @sequence-item-spacing,
  @sequence-step-height,
  @sequence-step-height-small,
  @sequence-icon-size
) {
  @total-margin: @sequence-outside-spacing * 2;
  @pip-offset: (@sequence-item-spacing + (@sequence-step-height-small / 2));

  &:before {
    height: calc(100% - @total-margin);
    margin-top: @sequence-outside-spacing;
  }
  > li {
    &:first-child {
      margin-top: @sequence-margin;
    }
    &:last-child {
      margin-bottom: @sequence-margin;
    }
    @media (min-width: @screen-md-min) {
      padding-top: @sequence-item-spacing;
      padding-bottom: @sequence-item-spacing;
    }
    &:first-child:after {
      margin-top: @pip-offset; //@sequence-outside-spacing;
      height: calc(100% - @pip-offset);
    }
    &:last-child:after {
      height: calc(100% - @pip-offset);
    }
  }
  > .active:after {
    height: ((@sequence-step-height-small / 2) + (@sequence-item-spacing / 2));
    @media (min-width: @screen-md-min) {
      // TODO seems wrong
      height: ((@sequence-step-height / 2) + (@sequence-item-spacing / 2));
    }
  }

  &.sequence-top {
    &:before {
      height: calc(100% - @sequence-outside-spacing);
      margin-top: 0;
    }
    > li:first-child {
      padding-top: @sequence-outside-spacing;
      margin-top: 0;

      &:after {
        height: 100%;
        margin-top: 0;
      }
      .sequence-icon {
        top: (((@sequence-step-height-small / 2) - (@sequence-icon-size / 2)) + @sequence-outside-spacing);
      }
    }
  }
  &.sequence-bottom {
    &:before {
      height: calc(100% - @sequence-outside-spacing);
    }
    > li:last-child {
      padding-bottom: @sequence-outside-spacing;
      margin-bottom: 0;
      &:after {
        height: 100%;
      }
      &.active:after {
        height: (@sequence-item-spacing + (@sequence-step-height-small / 2));
      }
      &.active:after:first-child {
        height: (@sequence-margin + @sequence-item-spacing + (@sequence-step-height-small / 2));
      }
    }
  }
  &.sequence-top.sequence-bottom:before {
    height: 100%;
  }

  .sequence-icon {
    top: @sequence-item-spacing;

    @media (min-width: @screen-md-min) {
      top: ((@sequence-step-height-small / 2) - (@sequence-icon-size / 2) + @sequence-item-spacing);
    }
  }
}

.sequence-horizontal-spacing(
  @sequence-item-padding,
  @sequence-pip-size,
  @sequence-icon-sm,
  @sequence-icon-md,
  @sequence-icon-lg
) {
  padding-left: @sequence-item-padding;
  > li {
    &:before {
      margin-left: (-@sequence-item-padding - (@sequence-pip-size / 2) + 1px);
    }
    &:after {
      left: -@sequence-item-padding;
    }
  }
  .sequence-icon {
    margin-left: (-@sequence-item-padding - (@sequence-icon-sm / 2) + 1px);
  }
  .sequence-icon-md {
    margin-left: (-@sequence-item-padding - (@sequence-icon-md / 2) + 1px);
  }
  .sequence-icon-lg {
    margin-left: (-@sequence-item-padding - (@sequence-icon-lg / 2) + 1px);
  }
}


.sequence {
  .sequence-vertical-spacing(
    @sequence-outside-spacing,
    @sequence-margin,
    @sequence-item-spacing,
    @sequence-step-height,
    @sequence-step-height-small,
    @sequence-icon-size
  );
  .sequence-horizontal-spacing(
    @sequence-spacing-horizontal,
    @sequence-pip-size,
    @sequence-icon-size,
    @sequence-icon-size-md,
    @sequence-icon-size-lg
  );

  position: relative;
  margin-left: (@sequence-spacing-horizontal + 1px);
  margin-top: 0;
  margin-bottom: 0;
  font-size: @font-size-small;
  border-color: @sequence-border;

  @media (min-width: @screen-md-min) {
    padding-right: @sequence-spacing-horizontal;
    font-size: @font-size-base;
  }

  &:before {
    content: " ";
    width: @sequence-line-width;
    left: 0;
    position: absolute;
    border-width: (@sequence-line-width / 2);
    border-style: solid;
    border-color: inherit;
  }

  > li {
    display: block;
    line-height: @sequence-step-height-small;
    position: relative;
    border-color: @sequence-border;

    //@media (min-width: @screen-md-min) {
    //  padding-top: @sequence-item-spacing;
    //  padding-bottom: @sequence-item-spacing;
    //}

    > a {
      display: block;
      text-decoration: none;
      font-weight: @font-weight-normal;
      color: @link-secondary-color;
      outline-offset: -1px;
      &:hover,
      &:focus {
        text-decoration: none;
        color: @link-secondary-hover-color;
      }
      &:active {
        color: @link-secondary-active-color;
      }
    }

    p {
      margin-bottom: 0;
      padding-bottom: 8px;

      &:last-child {
        padding-bottom: 0;
      }

      .text-max-width();
    }

    h1, h2, h3, h4, .h1, .h2, .h3, .h4, .btn-toolbar {
      margin-bottom: 16px;
    }

    &:before {
      content: "";
      display: block;
      position: absolute;
      width: @sequence-pip-size;
      height: @sequence-pip-size;
      // TODO this should be in vertical mixin
      margin-top: ((@sequence-step-height-small / 2) - (@sequence-pip-size / 2));
      border-radius: 50%;
      z-index: 2;
      border-width: (@sequence-pip-size / 2);
      border-style: solid;
      border-color: inherit;
      outline: 0;

      //@media (min-width: @screen-md-min) {
      //  margin-top: ((@sequence-step-height / 2) - (@sequence-pip-size / 2));
      //}
    }
    &:after {
      content: "";
      position: absolute;
      width: @sequence-line-width;
      top: 0;
      height: 100%;
      border-width: (@sequence-line-width / 2);
      border-style: solid;
      border-color: inherit;
      outline: 0;
    }
  }

  .sequence-item-no-pip:before {
    display: none;
  }

  > .active {
    font-weight: @font-weight-semi-bold;

    > a {
      text-decoration: none;
      color: @link-color;
      &:hover,
      &:focus {
        text-decoration: none;
        color: @link-hover-color;
      }
      &:active {
        color: @link-active-color;
      }
    }

    .small {
      color: @text-color;
      font-weight: @font-weight-normal;
    }
    &:before {
      border-color: @link-color;
    }
    &:first-child:after {
      height: 0;
    }
    ~ li {
      border-color: @sequence-border;
      &:after {
        width: 0;
      }
    }
  }
}

.sequence-top.sequence-bottom:before {
  height: 100%;
}

.sequence-top {
  > li:first-child:after {
    margin-top: 0;
    height: 100%;
  }
  .active:first-child:after {
    height: ((@sequence-step-height-small / 2) + @sequence-margin);

    @media (min-width: @screen-md-min) {
      height: ((@sequence-step-height / 2) + @sequence-margin);
    }
  }
}

.sequence-bottom {
  > li:last-child:after {
    height: 100%;
  }
}

.sequence-inverse {
  border-color: @sequence-inverse-border;
  > li {
    border-color: @sequence-inverse-border;
    > a {
      color: #FFF; // @nav-inverse-link-color;
    }
  }
  .active {
    ~ li {
      border-color: @sequence-inverse-border;
    }
    .small {
      color: @brand-smoke-plus-20;
    }
  }
}

.sequence-info > li {
  border-color: @state-info-border;
  &.active:before {
    border-color: @state-info-border;
    background-color: @state-info-border;
  }
}
.sequence-primary > li {
  border-color: @brand-navy;
  &.active:before {
    border-color: @brand-navy;
    background-color: @brand-navy;
  }
}
.sequence-success > li {
  border-color: @state-success-border;
  &.active:before {
    border-color: @state-success-border;
    background-color: @state-success-border;
  }
}
.sequence-warning > li {
  border-color: @state-warning-border;
  &.active:before {
    border-color: @state-warning-border;
    background-color: @state-warning-border;
  }
}
.sequence-danger > li {
  border-color: @state-danger-border;
  &.active:before {
    border-color: @state-danger-border;
    background-color: @state-danger-border;
  }
}

.sequence-hollow {
  > li:before {
    border-width: @sequence-line-width;
    background-color: @sequence-bg;
  }
  > .active {
    &:before {
      border-width: (@sequence-pip-size / 2);
    }
    ~ li:before {
      background-color: @sequence-bg;
    }
  }
  &.sequence-inverse > li:before {
    background-color: @sequence-inverse-bg;
  }
}

.sequence-icon {
  position: absolute;
  display: block;
  margin-left: (-@sequence-spacing-horizontal - (@sequence-icon-size / 2) + 1px);
  background-color: @sequence-bg;
  border-radius: 50%;
  width: @sequence-icon-size;
  height: @sequence-icon-size;
  line-height: (@sequence-icon-size - 1px);
  z-index: 2;
  text-align: center;
  text-decoration: none !important;
  border-width: 1px;
  border-style: solid;
  border-color: @text-color;
  top: @sequence-item-spacing;
  font-size: 12px;

  .icon {
    font-size: 16px;
    line-height: (@sequence-icon-size - 1px);
  }

  @media (min-width: @screen-md-min) {
    top: ((@sequence-step-height-small / 2) - (@sequence-icon-size / 2) + @sequence-item-spacing);
  }

  .sequence-inverse & {
    background-color: @sequence-inverse-bg;
    border-color: #FFF;
  }

  .sequence a & {
    color: @link-color;
    border-color: @link-color;
  }
  .sequence a:hover &,
  .sequence a:focus & {
    color: @link-hover-color;
    border-color: @link-hover-color;
  }

  .sequence-top li:first-child & {
    top: (((@sequence-step-height-small / 2) - (@sequence-icon-size / 2)) + @sequence-outside-spacing);
  }
}

.sequence-table {
  display: table;
  > li {
    display: table-row;
    > a {
      position: absolute;
    }
    > .sequence-table-td,
    > .sequence-table-th {
      display: table-cell;
      padding: 4px 12px 4px 0;

      &:last-child {
        padding-right: 0;
      }
    }
    > .sequence-table-th {
      color: @brand-navy-minus-10;
      white-space: nowrap;
    }
    &:before {
      position: initial;
    }
    &:after {
      // sequence-table is not compatible with progress variants, due to webkit
      // ignoring position relative on elements with display: table-row
      display: none;
    }
    .sequence-icon {
      position: initial;
      margin-top: (-@sequence-margin - 1);
    }
    &:first-child {
      .sequence-table-td,
      .sequence-table-th {
        padding-top: (@sequence-margin + 1); // Adding/removing one evens out spaces
      }
    }
    &:last-child {
      .sequence-table-td,
      .sequence-table-th {
        padding-bottom: (@sequence-margin - 1);
      }
    }
  }
}
.sequence-inverse > li > .sequence-table-th,
.sequence-inverse > li > .sequence-table-td {
  color: @brand-smoke-plus-10;
}


.sequence-icon-md {
  width: @sequence-icon-size-md;
  height: @sequence-icon-size-md;
  line-height: (@sequence-icon-size-md - 2px);
  margin-top: -6px;
  font-size: 14px;
}
.sequence-icon-lg {
  width: @sequence-icon-size-lg;
  height: @sequence-icon-size-lg;
  line-height: (@sequence-icon-size-lg - 2px);
  margin-top: -6px;
  font-size: 16px;
}

.sequence-lg {
  .sequence-horizontal-spacing(
    40px,
    @sequence-pip-size,
    @sequence-icon-size,
    @sequence-icon-size-md,
    @sequence-icon-size-lg
  );
  @media (min-width: @screen-md-min) {
    .sequence-horizontal-spacing(
      @sequence-spacing-horizontal-lg,
      @sequence-pip-size,
      @sequence-icon-size,
      @sequence-icon-size-md,
      @sequence-icon-size-lg
    );
    .sequence-vertical-spacing(
      @sequence-outside-spacing-lg,
      @sequence-margin-lg,
      @sequence-item-spacing-lg,
      @sequence-step-height,
      @sequence-step-height-small,
      @sequence-icon-size
    );
  }
}
